#!/usr/bin/make -f
# -*- makefile -*-
# This file was automatically generated by dh_make tool:
#	$ export DEBFULLNAME="Telef√≥nica I+D"
#	$ export DEBEMAIL="opensource@tid.es"
#	$ dh_make -c apache -n -i -p fiware-monitoring-ngsi-adapter_<x.y.z>

# Uncomment this to turn on verbose mode.
# export DH_VERBOSE=1

# Package installation custom variables
DH_FIWARE_USR:=fiware
DH_FIWARE_GRP:=fiware
DH_FIWARE_DIR:=/opt/fiware
DH_ADAPTER_SRV:=ngsi_adapter
DH_ADAPTER_USR:=$(DH_FIWARE_USR)
DH_ADAPTER_GRP:=$(DH_FIWARE_GRP)
DH_ADAPTER_DIR:=$(DH_FIWARE_DIR)/$(DH_ADAPTER_SRV)
DH_LOGGING_DIR:=/var/log/$(DH_ADAPTER_SRV)
DH_NODE_REQ_VERSION:=$(shell awk '/"node":/ {split($$0,v,/["~=<>]/); print v[6]}' src/package.json)

# Function to substitute variable $(1) in file $(2)
dh_var_subst = $(shell sed -i 's:\#$(1)\#:$(value $(1)):' $(2))

%:
	dh $@

override_dh_auto_build:

override_dh_install: DH_VARS=$(filter DH_%,$(.VARIABLES))
override_dh_install:
	dh_install -Xtest -Xreport -Xsite -Xnode_modules -Xdebian -X.git -X.svn -X.log
	$(foreach var,$(DH_VARS),$(call dh_var_subst,$(var),debian/preinst))
	$(foreach var,$(DH_VARS),$(call dh_var_subst,$(var),debian/postinst))
	$(foreach var,$(DH_VARS),$(call dh_var_subst,$(var),debian/postrm))
	$(foreach var,$(DH_VARS),$(call dh_var_subst,$(var),debian/$(DH_ADAPTER_SRV).init))

override_dh_installinit:
	dh_installinit --name=$(DH_ADAPTER_SRV) --no-start
